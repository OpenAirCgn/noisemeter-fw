#ifndef _NOISEMETER_H_
#define _NOISEMETER_H_

#include <stdint.h>

#define SAMPLE_RATE 48000 /* Adopt IIR filters appropriately */
#define PROCESSOR_CLOCK 80000000
#define SAMPLE_RELOAD (PROCESSOR_CLOCK / SAMPLE_RATE)
#define BUFFER_MS 125
#define BUFFERS_PER_S (1000/(BUFFER_MS))
#define BUFFER_SAMPLES ((SAMPLE_RATE * BUFFER_MS) / 1000)
// #define USE_USB_AUDIO /* BUFFER_MS should be 1 for this */
#define USE_USB_SERIAL

#define DBA_VAL_OFFSET 30.6
#define DBA_CASCADE_SIZE 2
#define DBA_CASCADE_COEFFS { \
0.373142255782348, 0, -0.373142255782348, 1.18718096981406, -0.253715488435304, \
0.991242954856734, -1.98248590971347, 0.991242954856734, 1.98244891661967, -0.98252290280726 \
};
//average up to 5 mins
#define DBA_AVERAGE_BUFSIZE ((BUFFERS_PER_S)*60*5)
#define DBA_AVERAGE_1S_BUFFERS ((BUFFERS_PER_S)*1)
#define DBA_AVERAGE_5S_BUFFERS ((BUFFERS_PER_S)*1)
#define DBA_AVERAGE_10S_BUFFERS ((BUFFERS_PER_S)*10)
#define DBA_AVERAGE_30S_BUFFERS ((BUFFERS_PER_S)*30)
#define DBA_AVERAGE_1M_BUFFERS ((BUFFERS_PER_S)*60)
#define DBA_AVERAGE_3M_BUFFERS ((BUFFERS_PER_S)*180)
#define DBA_AVERAGE_5M_BUFFERS ((BUFFERS_PER_S)*300)

#define DBC_VAL_OFFSET 29.3
#define DBC_CASCADE_SIZE 2
#define DBC_CASCADE_COEFFS { \
0.344610059270758,0.689220118541516,0.344610059270758,-0.60980183988955,0.231361602806518, \
0.997361059161782,-1.99472211832356,0.997361059161782,1.9947186317172,-0.994725604929931 \
};

#define USE_I2C_SLAVE 
#define I2C_SLAVE_ADDRESS 0x20 /* shifted left (alt: 0x10) */

void Noisemeter_Init(void);

void Noisemeter_SetAnalogGain(uint8_t gain); //gain 0=no gain, 1=x2, 2=x4, 3=x8, 4...=x16 

#endif

